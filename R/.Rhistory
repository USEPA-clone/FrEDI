is_NA = is_NA %>% na_if(0)
) %>%
mutate(annual_impacts = annual_impacts * is_NA) %>%
mutate(region = "National Total") %>%
mutate(impactType = "all") %>%
# select(c("sector", "adaptation", "impactType", "region", "model", "driverValue", "includeaggregate", "annual_impacts")) %>%
mutate(impacts_billions = annual_impacts/10^9) %>%
select(-c(is_NA))
sum_int_totals_slr %>% glimpse
for(sf_i in image_sourceFiles) try(source(sf_i))
c_modelTypes2 <- c("SLR")
plots_int_totals_slr <- c_modelTypes2 %>%
lapply(function(type_i, data=sum_int_totals_slr){
plot_i <- data %>%
mutate(sector = sector %>% factor(levels = c_sectorNames, labels = new_sector_names)) %>%
filter(model_type==type_i) %>%
plot_DOW_byModelType(
modelType = type_i,
yCol = "impacts_billions",
ncol=4,
silent=T,
margins = c(0, .2, .15, 0),
marginUnit = "cm"
)
}) %>%
(function(x){
names(x) <- c_modelTypes2; return(x)
})
plots_int_totals_slr$SLR
for(type_i in c_modelTypes2){
h_i <- ifelse(type_i=="GCM", 8, 3.5)
w_i <- 6.9
dev_i  <- "pdf"
plot_i <- plots_int_totals[[type_i]]
file_i <- today %>% paste("impactsByDegree", type_i, sep="_") %>% paste("pdf", sep=".")
path_i <- ibdResultsPath
ggsave(file_i, plot = plot_i, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
sum_int_byType %>% glimpse
# inputs_df_int %>% names
slr_modelValues <- c(0, 30, 50, 100, 150)
slr_modelLevels <- slr_modelValues %>% paste("cm")
sum_int_byType_slr <- ciraSLRImpacts2 %>%
mutate(impactYear = "N/A") %>%
filter(model %in% slr_modelLevels) %>%
mutate(model = model %>% factor(slr_modelLevels, slr_modelValues)) %>%
mutate(model = model %>% as.character %>% as.numeric) %>%
rename(driverValue = model) %>%
### Adjust years
filter(year %in% c(2050, 2090)) %>%
mutate(year = year %>% factor) %>%
rename(model = year) %>%
mutate(is_NA = annual_impacts %>% is.na) %>%
group_by_at(.vars=c(
"sector", "adaptation", "impactType", "impactYear", "model_type", "model", "driverValue"
)) %>%
summarize_at(.vars = c("annual_impacts", "is_NA"), sum, na.rm = T) %>%
mutate(
is_NA = is_NA < 7,
is_NA = is_NA * 1,
is_NA = is_NA %>% na_if(0)
) %>%
mutate(annual_impacts = annual_impacts * is_NA) %>%
mutate(region = "National Total") %>%
mutate(impactType = "all") %>%
# select(c("sector", "adaptation", "impactType", "region", "model", "driverValue", "includeaggregate", "annual_impacts")) %>%
mutate(impacts_billions = annual_impacts/10^9) %>%
select(-c(is_NA))
sum_int_byType_slr %>% glimpse
for(sf_i in image_sourceFiles) try(source(sf_i))
# c_sectorNames2 <- c("Southwest Dust", "Extreme Temperature", "Wind Damage", "Winter Recreation")
# c_sectorNames2 <- "Extreme Temperature"
c_sectorNames3 <- sum_int_byType_slr$sector %>% unique
plots_int_byType_slr <-
c_sectorNames3 %>%
lapply(function(sector_i, data=sum_int_byType_slr){
sector_i %>% print
df_i    <- data %>%
filter(sector==sector_i) %>%
as.data.frame
plots_i <- df_i %>%
plot_DOW_byImpactType(
sector=sector_i,
yCol = "impacts_billions"
)
Sys.sleep(0.2)
return(plots_i)
}) %>%
(function(x){
names(x) <- c_sectorNames3; return(x)
})
# sum_int_byType %>% filter(sector=="Extreme Temperature") %>% filter(!is.na(annual_impacts)) %>% nrow
plots_int_byType_slr$`Coastal Properties`
for(sector_i in c_sectorNames3){
### Get number of impact types
df_i    <- df_int_byType %>% filter(sector==sector_i) %>% as.data.frame
c_types <- df_i$impactType %>% unique
n_types <- c_types %>% length
c_adapt <- df_i$adaptation %>% unique
n_adapt <- c_adapt %>% length
# h_i <- ifelse(type_i=="GCM", 8, 3.5)
# w_i     <- ifelse(n_adapt>1, 6.9, 5)
h_i     <- n_types * 2.5 + 2.5
w_i     <- n_adapt * 3 + 1.5
# dev_i   <- "pdf"
dev_i   <- "png"
plots_i <- plots_int_byType[[sector_i]]
years_i <- plots_i %>% names
n_i     <- years_i %>% length
path_i  <- ibdResultsPath %>% file.path("byType")
if(n_i == 0){
plot_j <- plots_int_byType[[sector_i]][[1]]
file_j <- sector_i %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
} else{
for(j in 1:n_i){
impYear_j <- years_i[j]
plot_j    <- plots_int_byType[[sector_i]][[impYear_j]]
file_j    <- sector_i %>% paste(impYear_j, sep="_") %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
}
}
# df_int_byType %>% names
sum_int_byType <- df_int_byType %>%
filter(scenario %in% c_scen_int[1:7]) %>%
filter(model_type=="GCM") %>%
# select(-c("driverValue", "temp_C_global", "slr_cm")) %>%
# rename(driverValue = temp_C_conus) %>%
# filter(driverValue<=6) %>%
summarize_DOW_data(bySector = F, year=2020) %>%
mutate(impacts_billions = annual_impacts / 10^9)
sum_int_byType %>% glimpse
sum_int_byType %>% filter(!is.na(annual_impacts)) %>% nrow
for(sf_i in image_sourceFiles) try(source(sf_i))
# c_sectorNames2 <- c("Southwest Dust", "Extreme Temperature", "Wind Damage", "Winter Recreation")
# c_sectorNames2 <- "Extreme Temperature"
c_sectorNames2 <- sum_int_byType$sector %>% unique
plots_int_byType <-
c_sectorNames2 %>%
lapply(function(sector_i, data=sum_int_byType){
sector_i %>% print
df_i    <- data %>%
filter(sector==sector_i) %>%
as.data.frame
plots_i <- df_i %>%
plot_DOW_byImpactType(
sector=sector_i,
yCol = "impacts_billions"
)
Sys.sleep(0.2)
return(plots_i)
}) %>%
(function(x){
names(x) <- c_sectorNames2; return(x)
})
for(sector_i in c_sectorNames){
### Get number of impact types
df_i    <- df_int_byType %>% filter(sector==sector_i) %>% as.data.frame
c_types <- df_i$impactType %>% unique
n_types <- c_types %>% length
c_adapt <- df_i$adaptation %>% unique
n_adapt <- c_adapt %>% length
# h_i <- ifelse(type_i=="GCM", 8, 3.5)
# w_i     <- ifelse(n_adapt>1, 6.9, 5)
h_i     <- n_types * 2.5 + 2.5
w_i     <- n_adapt * 3 + 1.5
# dev_i   <- "pdf"
dev_i   <- "png"
plots_i <- plots_int_byType[[sector_i]]
years_i <- plots_i %>% names
n_i     <- years_i %>% length
path_i  <- ibdResultsPath %>% file.path("byType")
if(n_i == 0){
plot_j <- plots_int_byType[[sector_i]][[1]]
file_j <- sector_i %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
} else{
for(j in 1:n_i){
impYear_j <- years_i[j]
plot_j    <- plots_int_byType[[sector_i]][[impYear_j]]
file_j    <- sector_i %>% paste(impYear_j, sep="_") %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
}
}
for(sector_i in c_sectorNames3){
### Get number of impact types
df_i    <- df_int_byType %>% filter(sector==sector_i) %>% as.data.frame
c_types <- df_i$impactType %>% unique
n_types <- c_types %>% length
c_adapt <- df_i$adaptation %>% unique
n_adapt <- c_adapt %>% length
# h_i <- ifelse(type_i=="GCM", 8, 3.5)
# w_i     <- ifelse(n_adapt>1, 6.9, 5)
h_i     <- n_types * 2.5 + 2.5
w_i     <- n_adapt * 3 + 1.5
# dev_i   <- "pdf"
dev_i   <- "png"
plots_i <- plots_int_byType[[sector_i]]
years_i <- plots_i %>% names
n_i     <- years_i %>% length
path_i  <- ibdResultsPath %>% file.path("byType")
if(n_i == 0){
plot_j <- plots_int_byType[[sector_i]][[1]]
file_j <- sector_i %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
} else{
for(j in 1:n_i){
impYear_j <- years_i[j]
plot_j    <- plots_int_byType[[sector_i]][[impYear_j]]
file_j    <- sector_i %>% paste(impYear_j, sep="_") %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
}
}
# c_sectorNames2 <- c("Southwest Dust", "Extreme Temperature", "Wind Damage", "Winter Recreation")
# c_sectorNames2 <- "Extreme Temperature"
c_sectorNames3 <- sum_int_byType_slr$sector %>% unique
plots_int_byType_slr <-
c_sectorNames3 %>%
lapply(function(sector_i, data=sum_int_byType_slr){
sector_i %>% print
df_i    <- data %>%
filter(sector==sector_i) %>%
as.data.frame
plots_i <- df_i %>%
plot_DOW_byImpactType(
sector=sector_i,
yCol = "impacts_billions"
)
Sys.sleep(0.2)
return(plots_i)
}) %>%
(function(x){
names(x) <- c_sectorNames3; return(x)
})
# sum_int_byType %>% filter(sector=="Extreme Temperature") %>% filter(!is.na(annual_impacts)) %>% nrow
plots_int_byType_slr$`Coastal Properties`
for(sector_i in c_sectorNames3){
### Get number of impact types
df_i    <- plots_int_byType_slr %>% filter(sector==sector_i) %>% as.data.frame
c_types <- df_i$impactType %>% unique
n_types <- c_types %>% length
c_adapt <- df_i$adaptation %>% unique
n_adapt <- c_adapt %>% length
# h_i <- ifelse(type_i=="GCM", 8, 3.5)
# w_i     <- ifelse(n_adapt>1, 6.9, 5)
h_i     <- n_types * 2.5 + 2.5
w_i     <- n_adapt * 3 + 1.5
# dev_i   <- "pdf"
dev_i   <- "png"
plots_i <- plots_int_byType[[sector_i]]
years_i <- plots_i %>% names
n_i     <- years_i %>% length
path_i  <- ibdResultsPath %>% file.path("byType")
if(n_i == 0){
plot_j <- plots_int_byType[[sector_i]][[1]]
file_j <- sector_i %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
} else{
for(j in 1:n_i){
impYear_j <- years_i[j]
plot_j    <- plots_int_byType[[sector_i]][[impYear_j]]
file_j    <- sector_i %>% paste(impYear_j, sep="_") %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
}
}
for(sector_i in c_sectorNames3){
### Get number of impact types
df_i    <- df_int_byType %>% filter(sector==sector_i) %>% as.data.frame
c_types <- df_i$impactType %>% unique
n_types <- c_types %>% length
c_adapt <- df_i$adaptation %>% unique
n_adapt <- c_adapt %>% length
# h_i <- ifelse(type_i=="GCM", 8, 3.5)
# w_i     <- ifelse(n_adapt>1, 6.9, 5)
h_i     <- n_types * 2.5 + 2.5
w_i     <- n_adapt * 3 + 1.5
# dev_i   <- "pdf"
dev_i   <- "png"
plots_i <- plots_int_byType_slr[[sector_i]]
years_i <- plots_i %>% names
n_i     <- years_i %>% length
path_i  <- ibdResultsPath %>% file.path("byType")
if(n_i == 0){
plot_j <- plots_int_byType_slr[[sector_i]][[1]]
file_j <- sector_i %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
} else{
for(j in 1:n_i){
impYear_j <- years_i[j]
plot_j    <- plots_int_byType_slr[[sector_i]][[impYear_j]]
file_j    <- sector_i %>% paste(impYear_j, sep="_") %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
}
}
for(sector_i in c_sectorNames3){
### Get number of impact types
df_i    <- df_int_byType %>% filter(sector==sector_i) %>% as.data.frame
c_types <- df_i$impactType %>% unique
n_types <- c_types %>% length
c_adapt <- df_i$adaptation %>% unique
n_adapt <- c_adapt %>% length
# h_i <- ifelse(type_i=="GCM", 8, 3.5)
# w_i     <- ifelse(n_adapt>1, 6.9, 5)
h_i     <- n_types * 2.5 + 2.5
w_i     <- n_adapt * 3 + 1.5
# dev_i   <- "pdf"
# dev_i   <- "png"
dev_i   <- "pdf"
plots_i <- plots_int_byType_slr[[sector_i]]
years_i <- plots_i %>% names
n_i     <- years_i %>% length
path_i  <- ibdResultsPath %>% file.path("byType")
if(n_i == 0){
plot_j <- plots_int_byType_slr[[sector_i]][[1]]
file_j <- sector_i %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
} else{
for(j in 1:n_i){
impYear_j <- years_i[j]
plot_j    <- plots_int_byType_slr[[sector_i]][[impYear_j]]
file_j    <- sector_i %>% paste(impYear_j, sep="_") %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
}
}
sum_int_byType_slr <- ciraSLRImpacts2 %>%
# mutate(impactYear = "N/A") %>%
filter(model %in% slr_modelLevels) %>%
mutate(model = model %>% factor(slr_modelLevels, slr_modelValues)) %>%
mutate(model = model %>% as.character %>% as.numeric) %>%
rename(driverValue = model) %>%
### Adjust years
filter(year %in% c(2050, 2090)) %>%
mutate(year = year %>% factor) %>%
rename(model = year) %>%
mutate(is_NA = annual_impacts %>% is.na) %>%
group_by_at(.vars=c(
"sector", "adaptation", "impactType", "impactYear", "model_type", "model", "driverValue"
)) %>%
summarize_at(.vars = c("annual_impacts", "is_NA"), sum, na.rm = T) %>%
mutate(
is_NA = is_NA < 7,
is_NA = is_NA * 1,
is_NA = is_NA %>% na_if(0)
) %>%
mutate(annual_impacts = annual_impacts * is_NA) %>%
mutate(region = "National Total") %>%
mutate(impactType = "all") %>%
# select(c("sector", "adaptation", "impactType", "region", "model", "driverValue", "includeaggregate", "annual_impacts")) %>%
mutate(impacts_billions = annual_impacts/10^9) %>%
select(-c(is_NA))
sum_int_byType_slr %>% glimpse
plots_int_byType_slr <-
c_sectorNames3 %>%
lapply(function(sector_i, data=sum_int_byType_slr){
sector_i %>% print
df_i    <- data %>%
filter(sector==sector_i) %>%
as.data.frame
plots_i <- df_i %>%
plot_DOW_byImpactType(
sector=sector_i,
yCol = "impacts_billions"
)
Sys.sleep(0.2)
return(plots_i)
}) %>%
(function(x){
names(x) <- c_sectorNames3; return(x)
})
# sum_int_byType %>% filter(sector=="Extreme Temperature") %>% filter(!is.na(annual_impacts)) %>% nrow
plots_int_byType_slr$`Coastal Properties`$Interpolation
# inputs_df_int %>% names
slr_modelValues <- c(0, 30, 50, 100, 150)
slr_modelLevels <- slr_modelValues %>% paste("cm")
sum_int_byType_slr <- ciraSLRImpacts2 %>%
mutate(impactYear = NA) %>%
filter(model %in% slr_modelLevels) %>%
mutate(model = model %>% factor(slr_modelLevels, slr_modelValues)) %>%
mutate(model = model %>% as.character %>% as.numeric) %>%
rename(driverValue = model) %>%
### Adjust years
filter(year %in% c(2050, 2090)) %>%
mutate(year = year %>% factor) %>%
rename(model = year) %>%
mutate(is_NA = annual_impacts %>% is.na) %>%
group_by_at(.vars=c(
"sector", "adaptation", "impactType", "impactYear", "model_type", "model", "driverValue"
)) %>%
summarize_at(.vars = c("annual_impacts", "is_NA"), sum, na.rm = T) %>%
mutate(
is_NA = is_NA < 7,
is_NA = is_NA * 1,
is_NA = is_NA %>% na_if(0)
) %>%
mutate(annual_impacts = annual_impacts * is_NA) %>%
mutate(region = "National Total") %>%
mutate(impactType = "all") %>%
# select(c("sector", "adaptation", "impactType", "region", "model", "driverValue", "includeaggregate", "annual_impacts")) %>%
mutate(impacts_billions = annual_impacts/10^9) %>%
select(-c(is_NA))
sum_int_byType_slr %>% glimpse
for(sf_i in image_sourceFiles) try(source(sf_i))
# c_sectorNames2 <- c("Southwest Dust", "Extreme Temperature", "Wind Damage", "Winter Recreation")
# c_sectorNames2 <- "Extreme Temperature"
c_sectorNames3 <- sum_int_byType_slr$sector %>% unique
plots_int_byType_slr <-
c_sectorNames3 %>%
lapply(function(sector_i, data=sum_int_byType_slr){
sector_i %>% print
df_i    <- data %>%
filter(sector==sector_i) %>%
as.data.frame
plots_i <- df_i %>%
plot_DOW_byImpactType(
sector=sector_i,
yCol = "impacts_billions"
)
Sys.sleep(0.2)
return(plots_i)
}) %>%
(function(x){
names(x) <- c_sectorNames3; return(x)
})
# inputs_df_int %>% names
slr_modelValues <- c(0, 30, 50, 100, 150)
slr_modelLevels <- slr_modelValues %>% paste("cm")
sum_int_byType_slr <- ciraSLRImpacts2 %>%
mutate(impactYear = "NA") %>%
filter(model %in% slr_modelLevels) %>%
mutate(model = model %>% factor(slr_modelLevels, slr_modelValues)) %>%
mutate(model = model %>% as.character %>% as.numeric) %>%
rename(driverValue = model) %>%
### Adjust years
filter(year %in% c(2050, 2090)) %>%
mutate(year = year %>% factor) %>%
rename(model = year) %>%
mutate(is_NA = annual_impacts %>% is.na) %>%
group_by_at(.vars=c(
"sector", "adaptation", "impactType", "impactYear", "model_type", "model", "driverValue"
)) %>%
summarize_at(.vars = c("annual_impacts", "is_NA"), sum, na.rm = T) %>%
mutate(
is_NA = is_NA < 7,
is_NA = is_NA * 1,
is_NA = is_NA %>% na_if(0)
) %>%
mutate(annual_impacts = annual_impacts * is_NA) %>%
mutate(region = "National Total") %>%
mutate(impactType = "all") %>%
# select(c("sector", "adaptation", "impactType", "region", "model", "driverValue", "includeaggregate", "annual_impacts")) %>%
mutate(impacts_billions = annual_impacts/10^9) %>%
select(-c(is_NA))
sum_int_byType_slr %>% glimpse
for(sf_i in image_sourceFiles) try(source(sf_i))
# c_sectorNames2 <- c("Southwest Dust", "Extreme Temperature", "Wind Damage", "Winter Recreation")
# c_sectorNames2 <- "Extreme Temperature"
c_sectorNames3 <- sum_int_byType_slr$sector %>% unique
plots_int_byType_slr <-
c_sectorNames3 %>%
lapply(function(sector_i, data=sum_int_byType_slr){
sector_i %>% print
df_i    <- data %>%
filter(sector==sector_i) %>%
as.data.frame
plots_i <- df_i %>%
plot_DOW_byImpactType(
sector=sector_i,
yCol = "impacts_billions"
)
Sys.sleep(0.2)
return(plots_i)
}) %>%
(function(x){
names(x) <- c_sectorNames3; return(x)
})
for(sector_i in c_sectorNames3){
### Get number of impact types
df_i    <- df_int_byType %>% filter(sector==sector_i) %>% as.data.frame
c_types <- df_i$impactType %>% unique
n_types <- c_types %>% length
c_adapt <- df_i$adaptation %>% unique
n_adapt <- c_adapt %>% length
# h_i <- ifelse(type_i=="GCM", 8, 3.5)
# w_i     <- ifelse(n_adapt>1, 6.9, 5)
h_i     <- n_types * 2.5 + 2.5
w_i     <- n_adapt * 3 + 1.5
# dev_i   <- "pdf"
# dev_i   <- "png"
dev_i   <- "pdf"
plots_i <- plots_int_byType_slr[[sector_i]]
years_i <- plots_i %>% names
n_i     <- years_i %>% length
path_i  <- ibdResultsPath %>% file.path("byType")
if(n_i == 0){
plot_j <- plots_int_byType_slr[[sector_i]][[1]]
file_j <- sector_i %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
} else{
for(j in 1:n_i){
impYear_j <- years_i[j]
plot_j    <- plots_int_byType_slr[[sector_i]][[impYear_j]]
file_j    <- sector_i %>% paste(impYear_j, sep="_") %>% paste(dev_i, sep=".")
ggsave(file_j, plot = plot_j, device=dev_i, path=path_i, width=w_i, height=h_i, units="in")
}
}
}
